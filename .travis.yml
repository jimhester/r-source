language: c
sudo: false
env:
  - CURL_VERSION=7.43.0 ZLIB_VERSION=1.2.8 PCRE_VERSION=8.38 PREFIX=$HOME/R-bin

addons:
  apt:
    sources:
    - r-packages-precise
    packages:
    - git-svn
    - bash-completion
    - bison
    - debhelper
    - default-jdk
    - g++
    - gcc
    - gdb
    - gfortran
    - groff-base
    - libblas-dev
    - libbz2-dev
    - libcurl4-openssl-dev
    - libjpeg-dev
    - liblapack-dev
    - liblzma-dev
    - libncurses5-dev
    - libpango1.0-dev
    - libpcre3-dev
    - libpng-dev
    - libreadline-dev
    - libx11-dev
    - libxt-dev
    - subversion
    - texinfo
    - texlive-base
    - texlive-extra-utils
    - texlive-fonts-extra
    - texlive-fonts-recommended
    - texlive-generic-recommended
    - texlive-latex-base
    - texlive-latex-extra
    - texlive-latex-recommended
    - x11proto-core-dev
    - xauth
    - xdg-utils
    - xfonts-base
    - xvfb
    - zlib1g-dev

cache:
  - ccache

before_install:
  - tools/rsync-recommended
  - mkdir -p extra
  - pushd extra
  - wget --no-check-certificate http://zlib.net/zlib-$ZLIB_VERSION.tar.gz
  - tar xzf zlib-$ZLIB_VERSION.tar.gz
  - pushd "zlib-$ZLIB_VERSION"
  - ./configure --prefix=$PREFIX && make && make install
  - popd
  - wget --no-check-certificate "http://curl.haxx.se/download/curl-$CURL_VERSION.tar.gz"
  - tar zxf "curl-$CURL_VERSION.tar.gz"
  - pushd "curl-$CURL_VERSION"
  - ./configure --prefix=$PREFIX && make && make install
  - popd
  - wget --no-check-certificate ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-$PCRE_VERSION.tar.gz
  - tar xzf pcre-$PCRE_VERSION.tar.gz
  - pushd pcre-$PCRE_VERSION
  - ./configure --prefix=$PREFIX --enable-utf && make && make install
  - popd
  - popd

script:
  - git svn init https://svn.r-project.org/R/trunk
  - git update-ref refs/remotes/git-svn refs/heads/build-trunk
  - git svn rebase
  - mkdir build;pushd build
  - ../configure --prefix $PREFIX CPPFLAGS=-I$PREFIX/include LDFLAGS=-L$PREFIX/lib
  - make
  - make check || true
  - make install

before_deploy:
  - mkdir -p /tmp/R-bin
  - tar cJf /tmp/R-bin/R-devel.xz -C $(dirname $PREFIX) $(basename $PREFIX)

deploy:
  provider: s3
  local_dir: /tmp/R-bin
  on:
    repo: wch/r-source
    branch: build-trunk
  skip_cleanup: true
  bucket: rstudio-travis
  access_key_id:
    secure: ybPb3/ndcSddKpahoiHVn8VBLmkidPIUFE7JTrLbvcJr8nA4Qcm4VRWb4HeXqDOn9Mm8ibaUyk8UoLZ749sxLZaw7Oidxd9g9qSaRYL7VMXaO+J0iIEWADrs3Ytz2DcMMhap72OIW4SqG+YHXAAh5XJFt7WfpC57bELZQS1U6jcpMQ10lgHNZhl6YpiVy+8gyc/6TwLBUt7ksDS+KZYBm/LWa32N1K/v7fAVxp65sG9ETs33dOmQV823rKmlf3jtGNorMA5szfBpNkYnilHyD2ucLbKO7fS3VCjkLa7lwuu+VhY6R82XZhQbqpXDWbsQOGhYTayocIKyaguxG4OBxlmvAIlRECxbkaSC59rMBcVcjUzwhVUWuvw6zOsKNJ2gSqRqu/LlOOJrgVZLEEudgNgmPHlsXCcwKNF86V/jjLJjf85HV87C18TTZdQryWQCo6+LIZtj3AigmFsuJmNRGZSQDBZxdGNEWJALXS59mTS2ECGLrCnF5bj3CbIxoaqoEzF+CY2jnpXxYET5l/oS10DBRj2qEMBGcGNhg2mx5/Mt2jZfuQInShTey9ibA28b2IsM77TLd3kDafgqVH9ohZtI+fOURCDEFPyP2z1uWrMWEHNf9jie02W+N+3eZgB1uBN4gE7QxrG0sXECDD7P1zpegSI9onZeazFfsfIOKk4=
  secret_access_key:
    secure: rgWlqb0BeFr2UP2qRe4Bxp3htKnk7PSXtuQLXaR0fDP/ajSQ8Y5XPMk7n+Bd1BCBBIpo+mcssUywRR28WTwjcpibSgUHD3u1uVickabVpUNVMGdbncxiT4CPgYAIfHS+b7Ue1zRqpqdeS5XoI+zDLkMsBsnAne0mNVzvF8VjcN8riyt82pRWSEFsm2+PGW7QIH7GKIkWrGnLUQeIyOdStev5A705cdjH0dX69w61qgQ8Hbf7LKPoNMle+2cjVdkkxaRQLJfD5X59Ul7JXchk7mwbTMrAP0Qo7igEIWgiSxN2z9LuMw34/VcvXaN4gduz7k37G6tRX3olNish/4Y5AcZvEZv4lzVQpxmwvnpIBMr5G7aGWlQOWUj5vZEkSyxt2X3uQ17+GQ/o6WDnA8gIucztCUhblNh/T/YHEK83Pm8MqgH5KHVBYQg3j22bEic4hqcuoY5bGjPyhRil8CZe5mbMhNMtNb8B88C7y9IG7cmz85oUFzQiPR8X1Kn7m7dfdccDilQMz9891pf1sNY1oEO3J6ji0b7ptnsTzcD78JIrhutpqTpk5GqyKIpoO3Ou/efnE3/fkP2Aj1EVGoArve2aGM7Erb8LlmKuz6SLu6csUBU2musiLL19PzGjRn/SheSLWaHhRHlnJOjbYtLl32gmfHCGYpxfhy2sIGiB0yU=
