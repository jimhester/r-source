language: c
env:
- CURL_VERSION=7.43.0 ZLIB_VERSION=1.2.8 PREFIX=$HOME/R-bin
addons:
  apt:
    sources:
    - r-packages-precise
    packages:
    - git-svn
    - bash-completion
    - bison
    - debhelper
    - default-jdk
    - g++
    - gcc
    - gdb
    - gfortran
    - groff-base
    - libblas-dev
    - libbz2-dev
    - libcurl4-openssl-dev
    - libjpeg-dev
    - liblapack-dev
    - liblzma-dev
    - libncurses5-dev
    - libpango1.0-dev
    - libpcre3-dev
    - libpng-dev
    - libreadline-dev
    - libx11-dev
    - libxt-dev
    - subversion
    - texinfo
    - texlive-base
    - texlive-extra-utils
    - texlive-fonts-extra
    - texlive-fonts-recommended
    - texlive-generic-recommended
    - texlive-latex-base
    - texlive-latex-extra
    - texlive-latex-recommended
    - x11proto-core-dev
    - xauth
    - xdg-utils
    - xfonts-base
    - xvfb
    - zlib1g-dev
cache:
- ccache
before_install:
- tools/rsync-recommended
- mkdir -p extra
- pushd extra
- wget http://zlib.net/zlib-$ZLIB_VERSION.tar.gz
- tar xzf zlib-$ZLIB_VERSION.tar.gz
- pushd "zlib-$ZLIB_VERSION"
- ./configure --prefix=$PREFIX && make && make install
- popd
- wget "http://curl.haxx.se/download/curl-$CURL_VERSION.tar.gz"
- tar zxf "curl-$CURL_VERSION.tar.gz"
- pushd "curl-$CURL_VERSION"
- ./configure --prefix=$PREFIX && make && make install
- popd
- popd
script:
- git svn init https://svn.r-project.org/R/trunk
- git update-ref refs/remotes/git-svn refs/remotes/origin/HEAD
- git svn rebase
- mkdir build;pushd build
- CPPFLAGS="-I $PREFIX/include" LDFLAGS="-L $PREFIX/lib" ../configure --prefix $PREFIX
- make
- make check || true
- make install
- tar cJf R-devel.xz $PREFIX
deploy:
  provider: s3
  file: R-devel.xz
  on:
    repo: jimhester/r-source
    branch: trunk
  skip_cleanup: true
  secret_access_key:
    secure: n6+bWTfWx0yxgtdEdUNmdPP3z8RcoqtkRAVBvHxRDGrTejtq/Z2cwLSQAKU/EnrAmrzZqiwvIGTaM9rCJc80cQjXkrn1PnI/IUjVSxiWAFZZslTKCvkCKuL+VJd6KcvWCzh4Y0Nl8yThXdtxrxQ2v8M0hu49ubIYtzkJ0H+m2mRwUT2po6ZrEY5FL6ekw0oMTi2Jqecx5Go2h6K7upOKHNQ5QyAAytq6wGpmdslodSWzKuXN49+nUjaowvJiezTE3GSkRDMK7xcYvja/OBIXulHl6SsM0csYhXqtq5vhV9Mdp3WIvMioeHuL69QqGk64df6an9++zclhtGYLNJvBynsFkUr4VZ0d1KSrYcHyhjqEAFjl6bNwYbtMIrn6f53cgrsX3wqeXIgRY0Odd44RKog4Ecv9vhwn6nANbu/jL8YI1xrHAI2qh4ZpjMupojACQb2guAITQryvdfepKwKgaykUK5AYy5qIHYB2LNELujJI76IE/AJhxGDr/VJ0UGPoRnJsbLKlfwUKxRNxt5IBiY5Dk7LAzd+ypRWw2OcqymOHV19h+NBumJUqAxv6QNnbGx1bLsNgDt2wYsf3Sbfbg8n6dA1TYX46DnThM2ondB3btQLdSdGWDnmy5qgrYUMRHo7rjlPWR1iSX6+Oyufq2aAtH8HBk5udo5t4bNrmxfk=
  access_key_id:
    secure: DpsX8FbzFDgM7BrxjtRgUDtf3KJ/NvqfRba0cBnsc7HxHMrBkYMueSIWTM/WrqCyVdU39MwST+Kc6lVS9tbrP6sSOfMZVIOjZPSiDZZu6vYM2+vnFu7FsNuG5rG2u0Gkd4q43TnRrvCcEDYzX+TAfkFYM+4bRpQIngfBUggEo93usDbtAY+XNS4KdnjzK2x8e8wUEtTpFn79UN9T/ciE94VksP2qfuFzNUk2d6vYS0kZNCEkzBqfgXhZ4UFvWDq3iQwFZR2+w4xZCJ6Ri8gP7l1S4EWZwQAlQF4GH8UP1T96obBfa5bQG+pbI2CkD8LIienHp16Ka4PmJOBUJj+5ZT+NGkPNLZTfa0JaijqCK6W40NhS/orfKg+nJIAbMJyJh1V2MuPfJzvA81RLDIoYKweztKWgZEJ20dt4ANn66a8xQdP//w8MSGiCatV9pLRvQiEqb7NyZ82cNvhLsA+xkxMhin32mM6qWWQMJwAImft4up3jlnr26xCBr+OjKZ6gFUhhlCDWurswxPeSKywG56hfpzCCu1k0DCx1PtbKfzWAG75VmtOkSCIJhP3xOh10sYHO5zqILftaKGjL/Oz+lb3ivKXoa5R1JiZ6dUj+ocuZPoA97TtM9itY2zxMsp0Ok65H9GqtbJQI6upAX3RwamhZuM3yrr4HIg4BxEu5q8c=
  bucket: "rstudio-travis"
