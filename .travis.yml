language: c # or other C/C++ variants

env:
  - CURL_VERSION=7.43.0 ZLIB_VERSION=1.2.8

addons:
  apt:
    sources:
      - r-packages-precise
    packages:
      - git-svn
      # from rocker depends
      - bash-completion
      - bison
      - debhelper
      - default-jdk
      - g++
      - gcc
      - gdb
      - gfortran
      - groff-base
      - libblas-dev
      - libbz2-dev
      - libcurl4-openssl-dev
      - libjpeg-dev
      - liblapack-dev
      - liblzma-dev
      - libncurses5-dev
      - libpango1.0-dev
      - libpcre3-dev
      - libpng-dev
      - libreadline-dev
      - libx11-dev
      - libxt-dev
      - subversion
      - texinfo
      - texlive-base
      - texlive-extra-utils
      - texlive-fonts-extra
      - texlive-fonts-recommended
      - texlive-generic-recommended
      - texlive-latex-base
      - texlive-latex-extra
      - texlive-latex-recommended
      - x11proto-core-dev
      - xauth
      - xdg-utils
      - xfonts-base
      - xvfb
      - zlib1g-dev

cache:
  - ccache

before_install:
  - tools/rsync-recommended
    # zlib
  - mkdir -p extra
  - pushd extra
  - wget http://zlib.net/zlib-$ZLIB_VERSION.tar.gz
  - tar xzf zlib_$ZLIB_VERSION.tar.gz
  - pushd "zlib-$ZLIB_VERSION"
  - ./configure --prefix=$HOME && make && make install
  - popd
  # curl
  - wget "http://curl.haxx.se/download/curl-$CURL_VERSION.tar.gz"
  -  tar zxf "curl-$CURL_VERSION.tar.gz"
  - pushd "curl-$CURL_VERSION"
  - ./configure --prefix=$HOME && make && make install
  - popd
  - popd

script:
  # link the git head with SVN
  - git svn init https://svn.r-project.org/R/trunk
  - git update-ref refs/remotes/git-svn refs/remotes/origin/HEAD
  - git svn rebase
  # Actually build R
  - mkdir build;pushd build
  - CPPFLAGS="-I $HOME/include" LDFLAGS="-L $HOME/lib" ../configure
  - make
  - make check
