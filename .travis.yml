language: c # or other C/C++ variants

env:
  - CURL_VERSION=7.43.0 ZLIB_VERSION=1.2.8

addons:
  apt:
    sources:
      - r-packages-precise
    packages:
      - gfortran

cache:
  - ccache

before_install:
  - tools/rsync-recommended
    # zlib
  - mkdir -p extra
  - pushd extra
  - wget http://zlib.net/zlib-$ZLIB_VERSION.tar.gz
  - tar xzf zlib-$ZLIB_VERSION.tar.gz
  - pushd "zlib-$ZLIB_VERSION"
  - ./configure --prefix=$HOME && make && make install
  - popd
  # curl
  - wget "http://curl.haxx.se/download/curl-$CURL_VERSION.tar.gz"
  -  tar zxf "curl-$CURL_VERSION.tar.gz"
  - pushd "curl-$CURL_VERSION"
  - ./configure --prefix=$HOME && make && make install
  - popd
  - popd

script:
  # link the git head with SVN
  - git svn init https://svn.r-project.org/R/trunk
  - git update-ref refs/remotes/git-svn refs/remotes/origin/HEAD
  - git svn rebase
  # Actually build R
  - mkdir build;pushd build
  - CPPFLAGS="-I $HOME/include" LDFLAGS="-L $HOME/lib" ../configure
  - make
  #- make check
  - make install
